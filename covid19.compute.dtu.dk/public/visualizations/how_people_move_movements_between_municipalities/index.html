<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Movements between regions Visualization and data analysis by Ulf Aslak and Peter Møllgaard.  .vis { margin: 0 auto; height: 370px; } .vis1 { margin: 0 auto; height: 500px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-crisis { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .line-changeall { fill: none; stroke: black; stroke-width: 1; stroke-opacity: 0.7; } .line-tooltip { stroke: &#39;black&#39;; stroke-dasharray: 5 2."><meta property="og:title" content="" />
<meta property="og:description" content="Movements between regions Visualization and data analysis by Ulf Aslak and Peter Møllgaard.  .vis { margin: 0 auto; height: 370px; } .vis1 { margin: 0 auto; height: 500px; } .line-baseline { stroke: black; stroke-width: 1.5; fill: none; stroke-dasharray: 10 5; opacity: 0.2; } .line-crisis { fill: none; stroke: black; stroke-width: 2; stroke-opacity: 0.25; } .line-changeall { fill: none; stroke: black; stroke-width: 1; stroke-opacity: 0.7; } .line-tooltip { stroke: &#39;black&#39;; stroke-dasharray: 5 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://covid19.compute.dtu.dk/visualizations/how_people_move_movements_between_municipalities/" />
<meta property="article:modified_time" content="2020-07-08T16:03:14+02:00" />
<title>How People Move Movements Between Municipalities | COVID-19 mobility</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.8a947f30ccbc45289baa778fab553fcbefa728e514331d0228e194e9c7b19e9a.css" integrity="sha256-ipR/MMy8RSibqnePq1U/y&#43;&#43;nKOUUMx0CKOGU6cexnpo=">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-167958784-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/dtu.png" alt="Logo" /><span>COVID-19 mobility</span>
  </a>
</h2>












  <ul>
<li>
<p><strong><a href="/">Main Page</a></strong></p>
</li>
<li>
<p><strong>Posts</strong></p>
<ul>
<li><em>August</em>
<ul>
<li><a href="/posts/new_corona_and_travel/">19 - <em>Denmark</em>:<br>
New cases and travel</a></li>
</ul>
</li>
<li><em>July</em>
<ul>
<li><a href="/posts/midsommar/">16 - <em>Sweden</em>:<br>
Midsummer in Sweden</a></li>
</ul>
</li>
<li><em>June</em>
<ul>
<li><a href="/posts/escape_from_covid_island/">29 - <em>Gaming</em>:<br>
Escape from Covid island</a></li>
</ul>
</li>
<li><em>May</em>
<ul>
<li><a href="/posts/going_to_work/">18 - <em>Denmark</em>:<br>
Back to work</a></li>
<li><a href="/posts/spread_of_population/">14 - <em>Denmark</em>:<br>
Population re-distributed!</a></li>
<li><a href="/posts/change_in_population_sizes/">11 - <em>Denmark</em>: <br>
What&rsquo;s happening in my city?</a></li>
<li><a href="/posts/population_landscape/">7 - <em>Denmark</em>: <br>
Population landscape</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Visualizations</strong></p>
<ul>
<li><em>Where people are</em>
<ul>
<li><a href="/visualizations/where_people_are_landscape/">Landscape</a></li>
<li><a href="/visualizations/where_people_are_going_out/">Going out</a></li>
<li><a href="/visualizations/where_people_are_change_in_population_size/">Change in population size</a></li>
<li><a href="/visualizations/where_people_are_population_concentration/">Population distribution</a></li>
</ul>
</li>
<li><em>How people move</em>
<ul>
<li><a href="/visualizations/how_people_move_movements_between_municipalities/"class=active>Movements between regions</a></li>
<li><a href="/visualizations/how_people_move_distance_traveled/">Distance traveled</a></li>
<li><a href="/visualizations/how_people_move_staying_home/">Staying home</a></li>
</ul>
<!-- raw HTML omitted -->
</li>
</ul>
</li>
<li>
<p><strong>Data</strong></p>
<ul>
<li><a href="/data-description/population_density_maps/">Population Density Maps</a></li>
<li><a href="/data-description/movement_maps/">Movement Maps</a>
<!-- raw HTML omitted --></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>How People Move Movements Between Municipalities</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown"><h1 id="movements-between-regions"><strong>Movements between regions</strong></h1>
<span style="font-size:14px"><em>Visualization and data analysis by <a href="mailto:ulfaslak@gmail.com">Ulf Aslak</a> and <a href="mailto:peter-em@hotmail.com">Peter Møllgaard</a>.</em></span>
<p>



<style type="text/css">
	.vis {
		margin: 0 auto;
		height: 370px;
	}
	.vis1 {
		margin: 0 auto;
		height: 500px;
	}
	.line-baseline { 
		stroke: black;
		stroke-width: 1.5;
		fill: none;
		stroke-dasharray: 10 5;
		opacity: 0.2;
	}
 
	.line-crisis { 
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}
	.line-changeall { 
		fill: none;
		stroke: black;
		stroke-width: 1;
		stroke-opacity: 0.7;
	}
	.line-tooltip {
		stroke: 'black';
		stroke-dasharray: 5 2.5;
		stroke-width: 1.5;
	}
	.line { 
		fill: none;
		stroke: black;
		stroke-width: 2;
		stroke-opacity: 0.25;
	}
	.rect-tooltip {
		fill: white;
		fill-opacity: 0;
		z-index: 1;
	}
	.trendline {
		fill: none; 
		stroke: #5897fb;
		stroke-width: 2.5;
	}
	.brushline {
		fill: none; 
		stroke: #000000;
		stroke-width: 1.5;
	}
	.histEvent {
		stroke: grey;
		stroke-width: 2;
		stroke-opacity: 1;
	}
	.histEventDot {
		fill: grey;
	}
	.map-polygon-movements {
		stroke: grey;
		stroke-width: 0.3;
	}
	.map-polygon-movements-circumference {
		stroke: black;
		stroke-width: 1;
	}
	.dot-baseline {
		fill: white;
		stroke: #2c3e50;
		stroke-width: 2;
		opacity: 0;
	}
	.dot {
		fill: black;
		opacity: 0.5;
	}
	.right-legend {
		font-size: 12px;
		-webkit-user-select: none;          
		-moz-user-select: none;  
		-ms-user-select: none;  
		user-select: none;  
	}
	.tooltip {	
		position: absolute;
		top: 0;
		line-height: 1;
		font-weight: 500;
		padding: 12px;
		background: rgba(0, 0, 0, 0.8);
		color: #fff;
		border-radius: 2px;	
	}
	.toggle {
		-webkit-user-select: none;          
		-moz-user-select: none;  
		-ms-user-select: none;  
		user-select: none;  
	}
	.select-place {
		position: absolute;
  		width: 300px;
  		height: 10px;
		right: 0px;
	}
	.flex {
		display: flex;
	}
	.flex-col {
		flex-direction: column;
	}
	.radio-rect {
		cursor: pointer;
		fill: #636e72;
	}

	.radio-rect.selected {
		fill: #0984e3;
	}

	.radio-text {
		text-anchor: middle;
		stroke: none;
		fill: white;
		font-weight: 600;
		cursor: pointer;
	}

	.radio-text.selected {
		text-anchor: middle;
		stroke: none;
		fill: white;
		font-weight: 600;
	}

	@keyframes spinner-line-fade-quick {
	  0%, 39%, 100% {
	    opacity: 0.25;  
	  }
	  40% {
	    opacity: 1;
	  }
	}

</style>






<div style="max-height: 0px">
	<svg>
	  <defs>
	    <pattern id="lines" height="10" width="10" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="4" x2="10" y2="4" stroke-width="2" stroke="black"/>
	    </pattern>
	    <pattern id="thinlines" height="5" width="5" patternUnits="userSpaceOnUse" patternTransform="rotate(-45)">
	      <line x1="0" y1="2" x2="10" y2="2" stroke-width="0.5" stroke="black"/>
	    </pattern>
	  </defs>
	</svg>
</div>







<script src="/dist/d3.v5.min.js"></script>
<script src="/dist/d3-simple-slider.min.js"></script>
<script src="/dist/chroma.min.js"></script>
<script src="/dist/spin.min.js"></script>
<script src="/dist/slimselect.min.js"></script>
<link href="/dist/slimselect.min.css" rel="stylesheet"></link>


<script src="/scripts/eventDates.js"></script>
<script src="/scripts/kommunePop.js"></script>
<script src="/scripts/timeSeriesFigure.js"></script>
<script src="/scripts/choroplethMap.js"></script>
<script src="/scripts/choroplethMapBrush.js"></script>
<script src="/scripts/timeSliderScatterPlot.js"></script>

<script>

	
	

	console.log("Greetings! Thanks for visiting. Looking at the code? Tweet at @ulfaslak with questions, bugs, comments, etc.!")

	
	
	

	
	let spinnerOpts = {
		lines: 8, 
		length: 0, 
		width: 8, 
		radius: 18, 
		corners: 10, 
		color: '#313131', 
		fadeColor: 'transparent', 
		speed: 1, 
		rotate: 0, 
		animation: 'spinner-line-fade-quick', 
	};

	
	function adjustBaseline(datum) {
		datumy = d3.range(7).map(() => []);
		datum.forEach((d, i) => {
		    datumy[i%7].push(d[1]);
		});
		datumy = datumy.map(d => d3.mean(d));
		return datum.map((d, i) => [d[0], datumy[i%7]]);
	}

	
	function zip(a, b) {
		return a.map((e, i) => [e, b[i]]);
	}

	function round(val, order) {
		return Math.round(val * order) / order;
	}

	Date.prototype.addDays = function(n) {
	    let date = new Date(this.valueOf());
	    date.setDate(date.getDate() + n);
	    return date;
	}

	function weekavg(y) {
		let y_avg = [];
		y.forEach((v, i) => {
			let i0 = Math.max(0, i-3);
			let i1 = Math.min(y.length-1, i+4);
			y_avg.push(d3.mean(y.slice(i0, i1)));
		});
		return y_avg;
	}

	function insertKSeperators(x) {
	    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
	}

	function idify(str) {
		
		if (str.includes(" "))
			str = str.replace(/ /g, "-");
		if (isInt(str[0]))
			str = "d" + str;
		return str;
	}

	function isInt(str) {
		return !isNaN(str)
	}


</script>

<script>
    
    if (sessionStorage.country == undefined) {sessionStorage.country = "Denmark";}
    function createWorld() {
        var countries = []
        d3.json("/data/countries.json").then(function(data){
            countries = data.sort();
            body = document.getElementsByClassName('container flex')[0];
            toc = document.createElement('aside');
            toc.className = "book-toc";
            nav = document.createElement('nav');
            nav.id = "countries";
            ul = document.createElement('ul');
            countries.forEach(function (item,index){
                li = document.createElement('li');
                a = document.createElement('a');
                a.text = item;
                a.style.cursor = "pointer";
                if (item != sessionStorage.country) {
                    a.onclick = function() {
                        sessionStorage.country=item;
                        window.location.reload();
                    };
                } else {
                    a.style.color = "red";
                    a.style["font-weight"] = "bold";
                }
                li.appendChild(a);
                ul.appendChild(li);
            });
            nav.appendChild(ul);
            toc.appendChild(nav);
            body.appendChild(toc);
        })}
    createWorld();
</script></p>
<!-- raw HTML omitted -->
<p>Using the Movement Maps we can visualize the distribution of where people spend their days relative to their nights. While not accurate in every single case, it&rsquo;s perhaps easier to say that we are able to see where people <em>live</em> (spend their nights) and <em>work</em> (spend their days). Or even more compactly, that we can look at <strong>commuting patterns</strong> over time.</p>


<!DOCTYPE html>
<meta charset="utf-8">


<div class="flex">
	<div id="slider-movementsFig"></div>
	<div class="radio-timeframe" id='radio-movementsFig'></div>
</div>
<div class="flex flex-col">
	<div class='vis' id='vis-movementsFig'></div>
</div>






<script>

	let spinnermovements = new Spinner(spinnerOpts).spin(document.getElementById('vis-movementsFig'));

	let instance_movements;
	d3.json("/data/"+sessionStorage.country+"_geojson.json").then(function(geoData) {
		d3.json('/data/'+sessionStorage.country+'_movements_between_admin_regions.json').then(function(data) {
			spinnermovements.stop();
			instance_movements = new MovementsMap(data, geoData, 'movementsFig');
			instance_movements.setup();
			instance_movements.drawLayout();
			instance_movements.drawData();
		})
	})

</script>

<blockquote>
<p><strong>This figure is interactive!</strong> You can:</p>
<ul>
<li><strong>Hover</strong> the curser over an administrative region to display the share of the Facebook population that makes daily journeys we assume represents work.</li>
<li><strong>Click</strong> any administrative region to see where the population in that region goes to work.</li>
<li><strong>Drag</strong> the time slider to display data for different dates.</li>
<li><strong>Select</strong> either to display valus for the selected date (<em>On date</em>), the <em>Baseline</em> or the percentage deviation between these (<em>Change</em>).</li>
<li><strong>Hold</strong> <code>shift</code> key after having selected (clicked) a region to display where people who work there live (as opposed to the default: where people who live there work).</li>
<li><strong>Press</strong> the escape key to unselect a region.</li>
</ul>
</blockquote>
<p>Based on three daily time windows, the <em>Movement Maps</em> provide a &ldquo;travel count&rdquo; for some area <em>i</em> which is the number of active Facebook uses who spent the majority of the previous time window inside some other area <em>j</em>. As discussed in &lsquo;<strong>Data</strong> &gt; Movement Maps&rsquo;, this choice of aggregation by Facebook <strong>implies that we cannot accurately assess the full amount of travel happening between and within regions</strong>.</p>
<p>As noted above, however, we can reliably quantify which share of the population <strong>spends the working hours away from home</strong>. Specifically, given the way travel is aggregated in the Movement Maps, travel counts into regions/tiles in the night hours (16–00 window) represents the number of people that spend the majority of their working hours (8—16) somewhere else. Thus, it&rsquo;s not unreasonable to think of these travel counts as representing people <strong>commuting</strong>.</p>
<p><strong>The map above</strong> looks at day-to-day between-municipality commuting patterns before and after the lockdown. By default the map displays <em>Change</em>, which is the percentage deviation between the size of the working population on the date selected with the slider, and the corresponding baseline (before lockdown). Clicking <em>On date</em> shows value for the date selected in the slider and <em>Baseline</em> for the corresponding baseline day. You can click any municipality to reveal where people who live there go to work (and reversely hold <code>shift</code> to reveal where people working there live).</p>
<p>A general pattern is that people who live in urban municipalities also work where they live, whereas people who live in municipalities next to more urbanized municipalities tend to work away from their home municipality.</p>
<p>When moving the slider through time it is clear that that the deviation—the <em>change</em>—between <em>Baseline</em> and <em>On date</em> decreases. This is the same pattern that we summarize in &lsquo;<strong>Visualizations</strong> &gt; Staying home&rsquo; and &lsquo;<strong>Visualizations</strong> &gt; Going out&rsquo;.</p>
<p><em>Note</em>: When clicking an administrative region, <em>Change</em> values displayed on other regions can be dramatically large. This is because, typically, only a small share of region populations work outside their home region, and because of the deviation calculation is as simple as (<em>A</em> - <em>B</em>) / <em>B</em>, they can blow up if <em>B</em> is small.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>

</html>












